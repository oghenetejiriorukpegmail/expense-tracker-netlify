import{c as T,b as U,u as O,a as D,q as M,X as G}from"./index-DigxZtx1.js";import{r as b,j as e}from"./ui-components-HGHSQozB.js";import{t as V,F as Y,a as i,b as l,c,d,e as H,f as m,I as j}from"./input-CRt7uJVD.js";import{u as z,z as a}from"./form-libs-rs9Sv7dn.js";import{D as R,a as q,b as A,c as I,d as Z,e as $}from"./dialog-C5mG64l5.js";import{u as B,B as f}from"./button-DIi07IbY.js";import{T as L}from"./textarea-_oBjrA3M.js";import{R as W}from"./receipt-upload-B52gNKqR.js";import{L as K}from"./loader-circle-DRr2b1ki.js";import{f as P}from"./date-libs-B3w1lJ5d.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=T("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=T("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=T("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=T("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),ee=/^(0[1-9]|1[0-2])\/(0[1-9]|[12]\d|3[01])\/(19|20)\d{2}$/,se=y=>{const t={date:a.string().min(1,{message:"Date is required"}).regex(ee,{message:"Date must be in MM/DD/YYYY format"}),cost:a.string().min(1,{message:"Amount is required"}).refine(n=>!isNaN(parseFloat(n)),{message:"Amount must be a number"}).refine(n=>parseFloat(n)>0,{message:"Amount must be greater than 0"}),tripName:a.string().min(1,{message:"Trip is required"}),comments:a.string().optional()};return y==="travel"?a.object({...t,type:a.string().min(1,{message:"Expense type is required"}),description:a.string().min(1,{message:"Description/Purpose is required"}),vendor:a.string().min(1,{message:"Vendor name is required"}),location:a.string().min(1,{message:"Location is required"})}):a.object({...t,type:a.string().min(1,{message:"Expense type is required"}),vendor:a.string().min(1,{message:"Vendor name is required"}),location:a.string().min(1,{message:"Location is required"})})};function he(){const{ocrMethod:y,ocrTemplate:t}=U(),{addExpenseOpen:n,toggleAddExpense:x,defaultTripName:g}=O(),{toast:o}=B(),N=se(t),r=z({resolver:V(N),defaultValues:{date:P(new Date,"MM/dd/yyyy"),cost:"",tripName:g||"",comments:"",type:"",vendor:"",location:"",...t==="travel"&&{description:""}}}),[h,S]=b.useState(null),[F,E]=b.useState(!1);b.useEffect(()=>{if(n){const s={date:P(new Date,"MM/dd/yyyy"),cost:"",tripName:g||"",comments:"",type:"",vendor:"",location:"",...t==="travel"&&{description:""}};r.reset(s),S(null)}},[n,r,t,g]);const C=async s=>{E(!0);try{const u=new FormData;if(h){console.log("Submitting receipt for OCR processing..."),u.append("receipt",h),s.tripName&&u.append("tripName",s.tripName);const v=await D("POST","/api/expenses/process-ocr",u);if(v.status===202){const w=await v.json();o({title:"Receipt Processing Started",description:"Your receipt is being processed in the background."}),M.invalidateQueries({queryKey:["/api/expenses"]}),x()}else{const w=await v.json().catch(()=>({message:"Unknown error triggering OCR."}));throw new Error(w.message||`Failed to start OCR processing (Status: ${v.status})`)}}else console.log("Submitting expense manually..."),Object.entries(s).forEach(([v,w])=>{w!=null&&u.append(v,String(w))}),u.set("cost",String(parseFloat(s.cost))),await D("POST","/api/expenses",u),x(),M.invalidateQueries({queryKey:["/api/expenses"]}),o({title:"Expense added",description:"Expense added successfully"})}catch(u){console.error("Error submitting expense:",u),o({title:"Error Saving Expense",description:u instanceof Error?u.message:"An unknown error occurred",variant:"destructive"})}finally{E(!1)}},k=()=>e.jsxs(e.Fragment,{children:[e.jsx(l,{control:r.control,name:"date",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{className:"font-medium",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"MM/DD/YYYY",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"cost",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{className:"font-medium",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500 dark:text-gray-400",children:"$"}),e.jsx(j,{type:"number",step:"0.01",className:"pl-7",placeholder:"0.00",...s})]})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"tripName",render:({field:s})=>e.jsxs(c,{className:"md:col-span-2",children:[e.jsxs(i,{className:"font-medium",children:["Trip ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"Enter trip name",...s})}),e.jsx(m,{})]})})]}),p=()=>e.jsxs(e.Fragment,{children:[k(),e.jsx(l,{control:r.control,name:"description",render:({field:s})=>e.jsxs(c,{className:"md:col-span-2",children:[e.jsxs(i,{className:"font-medium",children:["Description/Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(L,{placeholder:"Describe the purpose...",className:"min-h-[80px]",...s})}),e.jsx(H,{children:"Provide a clear business purpose"}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"type",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{className:"font-medium",children:["Expense Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"e.g., Food, Transport",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"vendor",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{className:"font-medium",children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"Vendor name",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"location",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{className:"font-medium",children:["Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"City, Country",...s})}),e.jsx(m,{})]})})]}),Q=()=>e.jsxs(e.Fragment,{children:[k(),e.jsx(l,{control:r.control,name:"type",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{children:["Expense Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"e.g., Office Supplies",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"vendor",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"Vendor name",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"location",render:({field:s})=>e.jsxs(c,{children:[e.jsxs(i,{children:["Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(j,{placeholder:"Store Address",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:r.control,name:"comments",render:({field:s})=>e.jsxs(c,{className:"md:col-span-2",children:[e.jsx(i,{children:"Comments"}),e.jsx(d,{children:e.jsx(L,{placeholder:"Additional details or items...",className:"min-h-[80px]",...s})}),e.jsx(m,{})]})})]});return e.jsx(R,{open:n,onOpenChange:s=>{!s&&n&&x()},children:e.jsxs(q,{className:"max-w-xl",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Add New Expense"}),e.jsx(Z,{children:"Fill in the details below or upload a receipt."})]}),e.jsx(Y,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(C),className:"space-y-4 max-h-[75vh] overflow-y-auto pr-4 pl-1",children:[e.jsxs("div",{className:`p-3 rounded-md border text-sm font-medium ${t==="travel"?"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 text-gray-700 dark:text-gray-300"}`,children:["Template: ",t==="travel"?"Travel Expense":"General Receipt"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t==="travel"?p():Q()}),e.jsxs("div",{children:[e.jsx(i,{children:"Receipt (Optional)"}),e.jsx(W,{onFileSelect:S,selectedFile:h})]}),e.jsxs($,{className:"pt-4 sticky bottom-0 bg-background pb-2",children:[" ",e.jsx(f,{type:"button",variant:"outline",onClick:()=>x(),children:"Cancel"}),e.jsx(f,{type:"submit",disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Expense"})]})]})})]})})}const re=a.object({name:a.string().min(1,{message:"Trip name is required"}).max(100,{message:"Trip name must be less than 100 characters"}),description:a.string().optional()});function ue(){const{addTripOpen:y,toggleAddTrip:t}=O(),{toast:n}=B(),[x,g]=b.useState(!1),o=z({resolver:V(re),defaultValues:{name:"",description:""}});b.useEffect(()=>{y&&o.reset({name:"",description:""})},[y,o]);const N=async r=>{g(!0);try{await D("POST","/api/trips",r),t(),M.invalidateQueries({queryKey:["/api/trips"]}),n({title:"Trip added",description:"Trip has been added successfully"}),o.reset()}catch(h){n({title:"Error adding trip",description:h instanceof Error?h.message:"An unknown error occurred",variant:"destructive"})}finally{g(!1)}};return e.jsx(R,{open:y,onOpenChange:t,children:e.jsxs(q,{className:"max-w-md",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Add New Trip"}),e.jsx(Z,{children:"Create a new trip to organize your expenses"})]}),e.jsx(Y,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(N),className:"space-y-4",children:[e.jsx(l,{control:o.control,name:"name",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Trip Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Trip name",...r})}),e.jsx(m,{})]})}),e.jsx(l,{control:o.control,name:"description",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Description"}),e.jsx(d,{children:e.jsx(L,{placeholder:"Trip details...",className:"min-h-[100px]",...r,value:r.value||""})}),e.jsx(m,{})]})}),e.jsxs($,{className:"pt-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>t(),children:"Cancel"}),e.jsx(f,{type:"submit",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Trip"})]})]})})]})})}function je(){const{receiptViewerOpen:y,closeReceiptViewer:t,currentReceiptUrl:n}=O(),[x,g]=b.useState(1),[o,N]=b.useState(!1),[r,h]=b.useState(null),S=()=>{g(p=>Math.min(p+.25,3))},F=()=>{g(p=>Math.max(p-.25,.5))},E=()=>{if(!n)return;const p=document.createElement("a");p.href=n,p.download=n.split("/").pop()||"receipt",document.body.appendChild(p),p.click(),document.body.removeChild(p)},C=()=>{N(!0),h(null)},k=()=>{N(!1),h("Failed to load receipt image. The file may be corrupted or unavailable.")};return e.jsx(R,{open:y,onOpenChange:t,children:e.jsxs(q,{className:"max-w-3xl h-[90vh] flex flex-col",children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsx(I,{children:"Receipt Viewer"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{variant:"outline",size:"icon",onClick:F,disabled:x<=.5,children:e.jsx(_,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[Math.round(x*100),"%"]}),e.jsx(f,{variant:"outline",size:"icon",onClick:S,disabled:x>=3,children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"icon",onClick:E,disabled:!o,children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:t,children:e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex-grow overflow-auto flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-md p-4",children:n?r?e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("p",{children:r})]}):n.toLowerCase().endsWith(".pdf")?e.jsx("iframe",{src:n,title:"Receipt PDF",className:"w-full h-full border-0",onLoad:()=>{N(!0),h(null)},onError:k}):e.jsx("div",{style:{transform:`scale(${x})`,transition:"transform 0.2s ease"},className:"transform-origin-center",children:e.jsx("img",{src:n,alt:"Receipt",onLoad:C,onError:k,className:"max-h-full object-contain"})}):e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"No receipt selected"})})]})})}export{he as A,pe as P,je as R,ue as a};
