import{r as y,j as e}from"./ui-components-HGHSQozB.js";import{u as C}from"./data-fetching-CsvQ4U53.js";import{a as N}from"./auth-DQqL1F4Z.js";import{A,a as D,b,c as L,d as M,e as T,f as E,g as z,h as B}from"./alert-dialog-BTH45kxy.js";import{u as W,B as r}from"./button-DIi07IbY.js";import{u as $,a as h,q as x}from"./index-DigxZtx1.js";import{f as q}from"./date-libs-B3w1lJ5d.js";import{C as H}from"./sidebar-CmFT8L_W.js";import{C as U}from"./cloud-upload-Bzd53IsB.js";function O({trip:s}){const{toggleAddExpense:m,toggleEditTrip:p,toggleBatchUpload:u,toggleAddEditMileageLog:g}=$(),{toast:l}=W(),{getToken:i}=N(),[d,c]=y.useState(!1),{data:n}=C({queryKey:["/api/expenses",s.name],queryFn:async()=>{const t=await i();if(!t)throw new Error("Not authenticated");const o={Authorization:`Bearer ${t}`},f=`/api/expenses?tripName=${encodeURIComponent(s.name)}`;return(await h("GET",f,void 0,o)).json()},enabled:!!i}),a=(n==null?void 0:n.length)||0,w=n?n.reduce((t,o)=>t+parseFloat(o.cost||"0"),0).toFixed(2):"0.00",j=async()=>{c(!0);try{const t=await i();if(!t)throw new Error("Not authenticated");const o={Authorization:`Bearer ${t}`};await h("DELETE",`/api/trips/${s.id}`,void 0,o),x.invalidateQueries({queryKey:["/api/trips"]}),x.invalidateQueries({queryKey:["/api/expenses"]}),l({title:"Trip deleted",description:"The trip has been deleted successfully."})}catch(t){l({title:"Delete failed",description:t instanceof Error?t.message:"Unknown error occurred",variant:"destructive"})}finally{c(!1)}},v=()=>{m(s.name)},k=s.createdAt?q(new Date(s.createdAt),"MMM d, yyyy"):"Date unknown";return e.jsxs("div",{className:"p-4 border dark:border-gray-700 rounded-lg hover:shadow-md transition",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-base",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.description||""}),e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),k]}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center ml-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),a," expense",a!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx(r,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx("a",{href:`/expenses?trip=${encodeURIComponent(s.name)}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>p(s),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsxs(A,{children:[e.jsx(D,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs(b,{children:[e.jsxs(L,{children:[e.jsx(M,{children:"Delete Trip"}),e.jsx(T,{children:"Are you sure you want to delete this trip? This will also delete all associated expenses and cannot be undone."})]}),e.jsxs(E,{children:[e.jsx(z,{children:"Cancel"}),e.jsx(B,{className:"bg-red-500 hover:bg-red-600",onClick:j,disabled:d,children:d?"Deleting...":"Delete Trip"})]})]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:["$",w]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm ml-1",children:"total"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs(r,{size:"sm",className:"px-2.5 py-1 text-xs bg-primary text-white rounded hover:bg-blue-600",onClick:v,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Expense"]}),e.jsxs(r,{size:"sm",className:"px-2.5 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>g({tripId:s.id}),children:[e.jsx(H,{className:"h-3.5 w-3.5 mr-1"}),"+ Mileage"]}),e.jsx(r,{size:"sm",variant:"outline",className:`px-2.5 py-1 text-xs ${a===0?"opacity-50 cursor-not-allowed":""}`,asChild:!0,disabled:a===0,children:e.jsxs("a",{href:a>0?`/api/export-expenses?tripName=${encodeURIComponent(s.name)}`:void 0,download:!0,target:"_blank",rel:"noopener noreferrer",onClick:t=>{a===0&&t.preventDefault()},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export"]})}),e.jsxs(r,{size:"sm",variant:"outline",className:"px-2.5 py-1 text-xs",onClick:()=>u({id:s.id,name:s.name}),children:[e.jsx(U,{className:"h-3.5 w-3.5 mr-1"}),"Batch Upload"]})]})]})]})}export{O as T};
