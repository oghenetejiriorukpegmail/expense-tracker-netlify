import{r as j,j as e}from"./ui-components-HGHSQozB.js";import{F as k,b as a,c as i,a as n,d as o,I as d,f as l,e as M,t as w}from"./input-CRt7uJVD.js";import{u as R,z as c}from"./form-libs-rs9Sv7dn.js";import{D as U,a as A,b as L,c as V,d as $,e as P}from"./dialog-C5mG64l5.js";import{u as I,B as S}from"./button-DIi07IbY.js";import{T as C}from"./textarea-_oBjrA3M.js";import{b as O,u as B,a as z,q as G}from"./index-DigxZtx1.js";import{R as H}from"./receipt-upload-B52gNKqR.js";import{L as K}from"./loader-circle-DRr2b1ki.js";import{f as Q}from"./date-libs-B3w1lJ5d.js";import"./data-fetching-CsvQ4U53.js";import"./react-vendor-BDjHMAeo.js";import"./auth-DQqL1F4Z.js";import"./trash-2-BesVaEJk.js";import"./file-text-1oqK6nM4.js";import"./upload-glmsZqHP.js";const J=/^(0[1-9]|1[0-2])\/(0[1-9]|[12]\d|3[01])\/(19|20)\d{2}$/,W=x=>{const m={date:c.string().min(1,{message:"Date is required"}).regex(J,{message:"Date must be in MM/DD/YYYY format"}),cost:c.string().min(1,{message:"Amount is required"}).refine(t=>!isNaN(parseFloat(t)),{message:"Amount must be a number"}).refine(t=>parseFloat(t)>0,{message:"Amount must be greater than 0"}),tripName:c.string().min(1,{message:"Trip is required"}),comments:c.string().optional()};return x==="travel"?c.object({...m,type:c.string().min(1,{message:"Expense type is required"}),description:c.string().min(1,{message:"Description/Purpose is required"}),vendor:c.string().min(1,{message:"Vendor name is required"}),location:c.string().min(1,{message:"Location is required"})}):c.object({...m,type:c.string().min(1,{message:"Expense type is required"}),vendor:c.string().min(1,{message:"Vendor name is required"}),location:c.string().min(1,{message:"Location is required"})})};function pe(){const{ocrTemplate:x}=O(),{editExpenseOpen:m,editingExpense:t,toggleEditExpense:f}=B(),T=W(x),{toast:y}=I(),[N,v]=j.useState(!1),[h,u]=j.useState(null),[q,E]=j.useState(null),r=R({resolver:w(T),defaultValues:{type:"",date:"",vendor:"",location:"",cost:"",tripName:"",comments:""}});j.useEffect(()=>{if(m&&t){const s=t.date?Q(new Date(t.date),"MM/dd/yyyy"):"";r.reset({type:t.type||"",date:s,vendor:t.vendor||"",location:t.location||"",cost:String(t.cost)||"",tripName:t.tripName||"",comments:t.comments||""}),E(t.receiptPath?`/uploads/${t.receiptPath}`:null),u(null)}else m||(r.reset(),E(null),u(null))},[m,t,r]);const Y=async s=>{if(t){v(!0);try{const p=new FormData;Object.entries(s).forEach(([g,b])=>{b!=null&&p.append(g,String(b))}),p.set("cost",parseFloat(s.cost).toString()),h&&p.append("receipt",h);const F=await z("PUT",`/api/expenses/${t.id}`,p);if(!F.ok){const g=await F.text();throw new Error(g||"Failed to update expense")}f(),G.invalidateQueries({queryKey:["/api/expenses"]}),y({title:"Expense Updated",description:"Expense details have been updated successfully."})}catch(p){y({title:"Error Updating Expense",description:p instanceof Error?p.message:"An unknown error occurred",variant:"destructive"})}finally{v(!1)}}},D=()=>{f()};return e.jsx(U,{open:m,onOpenChange:s=>{s||D()},children:e.jsxs(A,{className:"max-w-xl",children:[e.jsxs(L,{children:[e.jsx(V,{children:"Edit Expense"}),e.jsx($,{children:"Update the details for this expense."})]}),e.jsx(k,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Y),className:"space-y-6",children:[e.jsx("div",{className:`p-3 rounded-md border mb-2 ${x==="travel"?"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800"}`,children:e.jsx("p",{className:`text-sm font-medium ${x==="travel"?"text-blue-700 dark:text-blue-300":"text-gray-700 dark:text-gray-300"}`,children:x==="travel"?"Editing Travel Expense":"Editing General Expense"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x==="travel"?e.jsxs(e.Fragment,{children:[e.jsx(a,{control:r.control,name:"tripName",render:({field:s})=>e.jsxs(i,{className:"col-span-2",children:[" ",e.jsxs(n,{children:["Trip ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"Enter trip name",...s})})," ",e.jsx(l,{})," "]})}),x==="travel"&&e.jsx(a,{control:r.control,name:"description",render:({field:s})=>e.jsxs(i,{className:"col-span-2",children:[e.jsxs(n,{children:["Description/Purpose ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{children:e.jsx(C,{placeholder:"Describe the purpose...",className:"min-h-[80px]",...s,value:s.value??""})}),e.jsx(l,{})]})}),e.jsx(a,{control:r.control,name:"date",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"MM/DD/YYYY",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"cost",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500 dark:text-gray-400",children:"$"}),e.jsx(d,{type:"number",step:"0.01",className:"pl-7",placeholder:"0.00",...s})]})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Expense Type ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"e.g., Food, Transportation",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"vendor",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"Vendor name",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"location",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Location ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"City, Country",...s})})," ",e.jsx(l,{})," "]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{control:r.control,name:"tripName",render:({field:s})=>e.jsxs(i,{className:"col-span-2",children:[" ",e.jsxs(n,{children:["Trip ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"Enter trip name",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Expense Type ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"e.g., Food, Transportation",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"vendor",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"Vendor name",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"location",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Location ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"City, Country",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"date",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsx(d,{placeholder:"MM/DD/YYYY",...s})})," ",e.jsx(l,{})," "]})}),e.jsx(a,{control:r.control,name:"cost",render:({field:s})=>e.jsxs(i,{children:[" ",e.jsxs(n,{children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]})," ",e.jsx(o,{children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500 dark:text-gray-400",children:"$"}),e.jsx(d,{type:"number",step:"0.01",className:"pl-7",placeholder:"0.00",...s})]})})," ",e.jsx(l,{})," "]})})]})}),e.jsx(a,{control:r.control,name:"comments",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Comments"}),e.jsx(o,{children:e.jsx(C,{placeholder:"Additional details...",className:"min-h-[80px]",...s,value:s.value??""})}),e.jsx(l,{})]})}),e.jsxs("div",{children:[e.jsx(n,{children:"Receipt"}),e.jsx(H,{onFileSelect:s=>u(s),selectedFile:h,currentReceiptUrl:q}),e.jsx(M,{children:"Upload a new receipt to replace the existing one (if any)."})]}),e.jsxs(P,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:D,children:"Cancel"}),e.jsx(S,{type:"submit",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Changes"})]})]})})]})})}export{pe as default};
