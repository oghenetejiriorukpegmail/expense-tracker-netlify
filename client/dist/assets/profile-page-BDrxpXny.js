import{j as e}from"./ui-components-HGHSQozB.js";import{u as E,b as A}from"./data-fetching-CsvQ4U53.js";import{u as T,z as t}from"./form-libs-rs9Sv7dn.js";import{t as q,F as I,b as i,c as n,a as l,d as c,I as m,f as d,e as B}from"./input-CRt7uJVD.js";import{a as y,q as L}from"./index-DigxZtx1.js";import{a as U}from"./auth-DQqL1F4Z.js";import{u as Y,B as u}from"./button-DIi07IbY.js";import{S as z}from"./sidebar-CmFT8L_W.js";import{A as D}from"./animated-page-XK2k_SWk.js";import{C as N,b as v,c as w,d as F,a as C}from"./card-CClv9YG9.js";import{T as M}from"./textarea-_oBjrA3M.js";import{L as P}from"./loader-circle-DRr2b1ki.js";import"./react-vendor-BDjHMAeo.js";const $=t.object({firstName:t.string().min(1,"First name is required"),lastName:t.string().optional(),phoneNumber:t.string().optional(),email:t.string().email("Invalid email address"),bio:t.string().optional()});function se(){const{toast:j}=Y(),{getToken:h,userId:f}=U(),{data:s,isLoading:g,error:p,refetch:k}=E({queryKey:["/api/profile"],queryFn:async()=>{try{const r=await h();if(!r)throw new Error("Not authenticated");const o={Authorization:`Bearer ${r}`};return(await y("GET","/api/profile",void 0,o)).json()}catch(r){throw console.error("Error fetching profile:",r),new Error(r.message||"Failed to load profile data. Please try again.")}},enabled:!!h,retry:2,retryDelay:r=>Math.min(1e3*2**r,1e4)}),a=T({resolver:q($),defaultValues:{firstName:"",lastName:"",phoneNumber:"",email:"",bio:""},values:s?{firstName:s.firstName||"",lastName:s.lastName||"",phoneNumber:s.phoneNumber||"",email:s.email||"",bio:s.bio||""}:void 0}),x=A({mutationFn:async r=>{try{const o=await h();if(!o)throw new Error("Not authenticated");const b={Authorization:`Bearer ${o}`};return(await y("PUT","/api/profile",r,b)).json()}catch(o){throw console.error("Error updating profile:",o),new Error(o.message||"Failed to update profile. Please try again.")}},onSuccess:r=>{L.setQueryData(["/api/profile"],r),j({title:"Profile Updated",description:"Your profile has been saved."})},onError:r=>{j({title:"Update Failed",description:r.message||"An error occurred while updating your profile.",variant:"destructive"})}}),S=r=>{x.mutate(r)};return e.jsxs("div",{className:"flex flex-col md:flex-row h-screen",children:[e.jsx(z,{}),e.jsxs(D,{className:"flex-1 overflow-y-auto p-4 md:p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Profile"}),e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsx(w,{children:"Your Information"}),e.jsx(F,{children:"Update your profile details."})]}),e.jsxs(C,{children:[g&&e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-primary"})}),p&&e.jsxs("div",{className:"text-red-600 p-4 bg-red-50 rounded border border-red-200",children:[e.jsxs("p",{className:"mb-2",children:["Error loading profile: ",p.message]}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>k(),className:"mt-2",children:"Try Again"})]}),!g&&!p&&s&&e.jsx(I,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(S),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:a.control,name:"firstName",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"First Name"}),e.jsx(c,{children:e.jsx(m,{placeholder:"Your first name",...r})}),e.jsx(d,{})]})}),e.jsx(i,{control:a.control,name:"lastName",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Last Name"}),e.jsx(c,{children:e.jsx(m,{placeholder:"Your last name",...r,value:r.value??""})}),e.jsx(d,{})]})})]}),e.jsx(i,{control:a.control,name:"phoneNumber",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Phone Number"}),e.jsx(c,{children:e.jsx(m,{placeholder:"Your phone number",...r,value:r.value??""})}),e.jsx(d,{})]})}),e.jsx(i,{control:a.control,name:"email",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Email"}),e.jsx(c,{children:e.jsx(m,{type:"email",placeholder:"your.email@example.com",...r})}),e.jsx(d,{})]})}),e.jsx(i,{control:a.control,name:"bio",render:({field:r})=>e.jsxs(n,{children:[e.jsx(l,{children:"Bio (Optional)"}),e.jsx(c,{children:e.jsx(M,{placeholder:"Tell us a little about yourself",...r,value:r.value??""})}),e.jsx(B,{children:"A short description about you."}),e.jsx(d,{})]})}),e.jsx(u,{type:"submit",disabled:x.isPending,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Changes"})]})})]})]}),e.jsxs(N,{className:"mt-6",children:[e.jsxs(v,{children:[e.jsx(w,{children:"Change Password"}),e.jsx(F,{children:"Update your account password."})]}),e.jsx(C,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"mb-4",children:"Password changes are managed through your Clerk account settings."}),e.jsx("p",{className:"mb-4",children:"Click on your profile picture in the sidebar to access account settings, where you can change your password and manage other account details."}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[e.jsx(u,{variant:"outline",onClick:()=>window.open(`https://accounts.clerk.dev/user/${f}`,"_blank"),children:"Open Account Settings"}),e.jsx(u,{variant:"secondary",onClick:()=>window.open(`https://accounts.clerk.dev/user/${f}/security`,"_blank"),children:"Manage Security Settings"})]})]})})]})]})]})}export{se as default};
